# Tool Contract: get_gene

tool_name: get_gene
phase: strict
protocol: Fuzzy-to-Fact Phase 2

description: |
  Get complete gene record from NCBI Gene database by NCBIGene CURIE.
  Requires resolved CURIE from search_genes().
  Returns full gene data with cross-references to HGNC, Ensembl, UniProt, RefSeq, OMIM.
  Uses NCBI E-utilities efetch with XML parsing.

inputs:
  entrez_id:
    type: string
    required: true
    pattern: "^NCBIGene:\\d+$"
    description: NCBIGene CURIE from search_genes()
    examples:
      - "NCBIGene:7157"   # TP53
      - "NCBIGene:672"    # BRCA1
      - "NCBIGene:1017"   # CDK2

  slim:
    type: boolean
    required: false
    default: false
    description: |
      If true, return minimal fields (id, symbol, name, organism) for token efficiency.
      Default false returns full gene record with summary and cross_references.

output:
  type: EntrezGene
  schema:
    type: object
    required: [id, symbol, name, organism]
    properties:
      id:
        type: string
        pattern: "^NCBIGene:\\d+$"
        example: "NCBIGene:7157"
      symbol:
        type: string
        example: "TP53"
      name:
        type: string
        example: "tumor protein p53"
      description:
        type: string
        nullable: true
        example: "cellular tumor antigen p53; phosphoprotein p53"
      summary:
        type: string
        nullable: true
        example: "This gene encodes a tumor suppressor protein containing transcriptional activation, DNA binding, and oligomerization domains..."
      map_location:
        type: string
        nullable: true
        example: "17p13.1"
      chromosome:
        type: string
        nullable: true
        example: "17"
      aliases:
        type: array
        nullable: true
        items:
          type: string
        example: ["P53", "TRP53", "LFS1", "BCC7"]
      organism:
        type: string
        example: "Homo sapiens"
      taxon_id:
        type: integer
        nullable: true
        example: 9606
      cross_references:
        type: object
        nullable: true
        description: Cross-references following 22-key Agentic Biolink registry
        properties:
          hgnc:
            type: string
            pattern: "^HGNC:\\d+$"
            example: "HGNC:11998"
          ensembl_gene:
            type: string
            pattern: "^ENSG\\d{11}$"
            example: "ENSG00000141510"
          uniprot:
            type: string
            example: "UniProtKB:P04637"
          refseq:
            oneOf:
              - type: string
              - type: array
                items:
                  type: string
            example: "NM_000546.6"
          omim:
            type: string
            example: "191170"

errors:
  UNRESOLVED_ENTITY:
    http_status: 400
    message: "Invalid NCBIGene CURIE format"
    recovery_hint: "Call search_genes to resolve the identifier first. Expected format: NCBIGene:<numeric_id>"
    trigger: Input doesn't match NCBIGene CURIE pattern

  ENTITY_NOT_FOUND:
    http_status: 404
    message: "Gene not found in NCBI Gene database"
    recovery_hint: "Verify the NCBIGene ID or use search_genes to find the correct identifier"
    trigger: NCBI API returns empty result or error for the ID

  RATE_LIMITED:
    http_status: 429
    message: "Exceeded NCBI rate limit"
    recovery_hint: "Wait and retry. Add NCBI_API_KEY env var for 10 req/s limit (vs 3 req/s default)"
    trigger: More than 3 (or 10 with key) requests per second

  UPSTREAM_ERROR:
    http_status: 502/503/504
    message: "NCBI E-utilities API error"
    recovery_hint: "NCBI service may be temporarily unavailable. Retry after a short delay."
    trigger: NCBI API returns 5xx error or XML parsing fails

examples:
  - name: Get TP53 gene (full mode)
    input:
      entrez_id: "NCBIGene:7157"
      slim: false
    output:
      id: "NCBIGene:7157"
      symbol: "TP53"
      name: "tumor protein p53"
      description: "cellular tumor antigen p53; phosphoprotein p53; antigen NY-CO-13"
      summary: "This gene encodes a tumor suppressor protein containing transcriptional activation, DNA binding, and oligomerization domains. The encoded protein responds to diverse cellular stresses to regulate expression of target genes..."
      map_location: "17p13.1"
      chromosome: "17"
      aliases: ["P53", "TRP53", "LFS1", "BCC7"]
      organism: "Homo sapiens"
      taxon_id: 9606
      cross_references:
        hgnc: "HGNC:11998"
        ensembl_gene: "ENSG00000141510"
        uniprot: "UniProtKB:P04637"
        refseq: "NM_000546.6"
        omim: "191170"

  - name: Get BRCA1 gene (slim mode)
    input:
      entrez_id: "NCBIGene:672"
      slim: true
    output:
      id: "NCBIGene:672"
      symbol: "BRCA1"
      name: "BRCA1 DNA repair associated"
      organism: "Homo sapiens"

  - name: Invalid CURIE format error
    input:
      entrez_id: "7157"  # Missing "NCBIGene:" prefix
    error:
      code: "UNRESOLVED_ENTITY"
      message: "The input '7157' is not a valid NCBIGene CURIE."
      recovery_hint: "Call search_genes to resolve the identifier first. Expected format: NCBIGene:<numeric_id>"
      invalid_input: "7157"

  - name: Gene not found error
    input:
      entrez_id: "NCBIGene:999999999999"
    error:
      code: "ENTITY_NOT_FOUND"
      message: "Gene not found in NCBI Gene database"
      recovery_hint: "Verify the NCBIGene ID or use search_genes to find the correct identifier"
      invalid_input: "NCBIGene:999999999999"

adr_compliance:
  - ADR-001 Section 3: Fuzzy-to-Fact Phase 2 (accepts only resolved CURIEs)
  - ADR-001 Section 4: Agentic Biolink schema with cross_references
  - ADR-001 Section 8: Canonical ErrorEnvelope
  - Constitution III: Schema Determinism (omit-if-null for cross_references)
  - Constitution IV: Token Budgeting (slim mode support)
  - Constitution v1.1: Rate limiting (3 or 10 req/s based on API key)
