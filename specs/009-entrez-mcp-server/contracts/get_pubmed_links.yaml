# Tool Contract: get_pubmed_links

tool_name: get_pubmed_links
phase: strict
protocol: Literature Discovery

description: |
  Get PubMed IDs associated with a gene from NCBI Gene database.
  Requires resolved NCBIGene CURIE from search_genes().
  Returns list of PubMed IDs for evidence gathering and literature review.
  Uses NCBI E-utilities elink with gene_pubmed linkname.

inputs:
  entrez_id:
    type: string
    required: true
    pattern: "^NCBIGene:\\d+$"
    description: NCBIGene CURIE from search_genes()
    examples:
      - "NCBIGene:7157"   # TP53
      - "NCBIGene:672"    # BRCA1
      - "NCBIGene:1017"   # CDK2

  limit:
    type: integer
    required: false
    default: 10
    min: 1
    max: 100
    description: Maximum number of PubMed IDs to return

output:
  type: array
  description: List of PubMed IDs as strings
  items:
    type: string
    pattern: "^\\d+$"
  schema:
    type: array
    items:
      type: string
    example: ["39804234", "39804163", "39803982", "39803897", "39803721"]

errors:
  UNRESOLVED_ENTITY:
    http_status: 400
    message: "Invalid NCBIGene CURIE format"
    recovery_hint: "Call search_genes to resolve the identifier first. Expected format: NCBIGene:<numeric_id>"
    trigger: Input doesn't match NCBIGene CURIE pattern

  ENTITY_NOT_FOUND:
    http_status: 404
    message: "Gene not found or has no PubMed links"
    recovery_hint: "Verify the NCBIGene ID. Some genes may not have associated literature."
    trigger: NCBI elink returns empty linksets

  RATE_LIMITED:
    http_status: 429
    message: "Exceeded NCBI rate limit"
    recovery_hint: "Wait and retry. Add NCBI_API_KEY env var for 10 req/s limit (vs 3 req/s default)"
    trigger: More than 3 (or 10 with key) requests per second

  UPSTREAM_ERROR:
    http_status: 502/503/504
    message: "NCBI E-utilities API error"
    recovery_hint: "NCBI service may be temporarily unavailable. Retry after a short delay."
    trigger: NCBI API returns 5xx error

examples:
  - name: Get PubMed links for TP53 (default limit)
    input:
      entrez_id: "NCBIGene:7157"
    output:
      - "39804234"
      - "39804163"
      - "39803982"
      - "39803897"
      - "39803721"
      - "39803654"
      - "39803512"
      - "39803498"
      - "39803421"
      - "39803387"

  - name: Get limited PubMed links for BRCA1
    input:
      entrez_id: "NCBIGene:672"
      limit: 5
    output:
      - "39801234"
      - "39801098"
      - "39800987"
      - "39800876"
      - "39800765"

  - name: Gene with no literature
    description: Some genes may have no associated PubMed articles
    input:
      entrez_id: "NCBIGene:123456789"
    output: []

  - name: Invalid CURIE format error
    input:
      entrez_id: "TP53"  # Raw symbol, not CURIE
    error:
      code: "UNRESOLVED_ENTITY"
      message: "The input 'TP53' is not a valid NCBIGene CURIE."
      recovery_hint: "Call search_genes to resolve the identifier first. Expected format: NCBIGene:<numeric_id>"
      invalid_input: "TP53"

usage_notes:
  - |
    **Token Efficiency**: This tool returns only PubMed IDs, not full article data.
    For complete article metadata (title, abstract, authors), use a PubMed MCP server
    with the returned PMIDs.

  - |
    **Link Types**: Uses the `gene_pubmed` linkname which returns all PubMed citations
    associated with the gene. For more specific links (e.g., GeneRIF-annotated articles),
    consider extending the API in future versions.

  - |
    **Pagination**: Unlike search_genes, this tool uses a simple limit parameter
    rather than cursor-based pagination. Most use cases need only the top N citations.

  - |
    **Evidence Gathering**: Combine with multi-hop workflows:
    1. search_genes("BRCA1") -> get NCBIGene CURIE
    2. get_gene(curie) -> get cross_references
    3. get_pubmed_links(curie, limit=10) -> get supporting literature

adr_compliance:
  - ADR-001 Section 3: Strict tool (accepts only resolved CURIEs)
  - ADR-001 Section 8: Canonical ErrorEnvelope for errors
  - Constitution III: Schema Determinism (simple list output)
  - Constitution IV: Token Budgeting (limit parameter, IDs only)
  - Constitution v1.1: Rate limiting (3 or 10 req/s based on API key)
