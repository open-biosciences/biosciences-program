# Tool Contract: get_gene

tool_name: get_gene
phase: strict
protocol: Fuzzy-to-Fact Phase 2

description: |
  Strict lookup of complete gene record by Ensembl Gene ID.
  Requires valid ENSG ID from search_genes Phase 1 resolution.
  Returns full gene details with cross-references to external databases.

inputs:
  ensembl_id:
    type: string
    required: true
    pattern: "^ENSG\\d{11}$"
    description: Ensembl Gene ID (format ENSG + 11 digits)
    examples:
      - "ENSG00000141510"  # TP53
      - "ENSG00000012048"  # BRCA1
      - "ENSG00000157764"  # BRAF

  slim:
    type: boolean
    required: false
    default: false
    description: Return minimal fields without cross_references (~50 vs ~150-350 tokens)

output:
  envelope: null  # Direct entity return (not paginated)
  content_type: EnsemblGene
  schema:
    type: object
    properties:
      id:
        type: string
        pattern: "^ENSG\\d{11}$"
        example: "ENSG00000141510"
      symbol:
        type: string
        example: "TP53"
      name:
        type: string
        example: "tumor protein p53"
      biotype:
        type: string
        example: "protein_coding"
      species:
        type: string
        example: "homo_sapiens"
      assembly_name:
        type: string
        example: "GRCh38"
      chromosome:
        type: string
        example: "17"
      start:
        type: integer
        example: 7661779
      end:
        type: integer
        example: 7687538
      strand:
        type: integer
        enum: [1, -1]
        example: -1
      transcripts:
        type: array
        items:
          type: string
          pattern: "^ENST\\d{11}$"
        example: ["ENST00000269305", "ENST00000445888"]
        nullable: true
      cross_references:
        type: object
        description: External database identifiers (keys omitted if no value)
        properties:
          hgnc:
            type: string
            pattern: "^HGNC:\\d+$"
            example: "HGNC:11998"
          uniprot:
            type: array
            items:
              type: string
            example: ["P04637"]
          entrez:
            type: string
            example: "7157"
          refseq:
            type: array
            items:
              type: string
            example: ["NM_000546", "NP_000537"]
          omim:
            type: string
            example: "191170"
          pdb:
            type: array
            items:
              type: string
            example: ["1TUP", "2OCJ"]
          kegg:
            type: string
            example: "hsa:7157"
          chembl:
            type: string
            example: "CHEMBL3927"
          string:
            type: string
            example: "9606.ENSP00000269305"

errors:
  UNRESOLVED_ENTITY:
    http_status: 400
    message: "Invalid Ensembl Gene ID format"
    recovery_hint: "Use search_genes to find valid Ensembl Gene IDs. Format: ENSG + 11 digits (e.g., ENSG00000141510)"
    trigger: Input does not match ^ENSG\d{11}$ pattern

  ENTITY_NOT_FOUND:
    http_status: 404
    message: "Gene not found in Ensembl"
    recovery_hint: "The Ensembl ID does not exist. Verify the ID or use search_genes to find valid gene identifiers."
    trigger: Valid format but Ensembl API returns 404

  RATE_LIMITED:
    http_status: 429
    message: "Exceeded rate limit (15 requests/second)"
    recovery_hint: "Wait for the time specified in Retry-After header before retrying"
    trigger: Ensembl API returns HTTP 429

  UPSTREAM_ERROR:
    http_status: 502/503/504
    message: "Ensembl API error"
    recovery_hint: "Ensembl service may be temporarily unavailable. Retry after a few seconds."
    trigger: Ensembl API returns 5xx error

examples:
  - name: Get TP53 gene
    input:
      ensembl_id: "ENSG00000141510"
    output:
      id: "ENSG00000141510"
      symbol: "TP53"
      name: "tumor protein p53"
      biotype: "protein_coding"
      species: "homo_sapiens"
      assembly_name: "GRCh38"
      chromosome: "17"
      start: 7661779
      end: 7687538
      strand: -1
      transcripts:
        - "ENST00000269305"
        - "ENST00000445888"
      cross_references:
        hgnc: "HGNC:11998"
        uniprot: ["P04637"]
        entrez: "7157"
        refseq: ["NM_000546"]
        omim: "191170"
        pdb: ["1TUP", "2OCJ"]

  - name: Get gene in slim mode
    input:
      ensembl_id: "ENSG00000012048"
      slim: true
    output:
      id: "ENSG00000012048"
      symbol: "BRCA1"
      name: "BRCA1 DNA repair associated"
      biotype: "protein_coding"
      species: "homo_sapiens"
      assembly_name: "GRCh38"
      chromosome: "17"
      start: 43044295
      end: 43170245
      strand: -1
      # cross_references omitted in slim mode

  - name: Invalid ID format error
    input:
      ensembl_id: "TP53"
    error:
      code: "UNRESOLVED_ENTITY"
      message: "Invalid Ensembl Gene ID format"
      recovery_hint: "Use search_genes to find valid Ensembl Gene IDs. Format: ENSG + 11 digits (e.g., ENSG00000141510)"
      invalid_input: "TP53"

  - name: Gene not found error
    input:
      ensembl_id: "ENSG99999999999"
    error:
      code: "ENTITY_NOT_FOUND"
      message: "Gene 'ENSG99999999999' not found in Ensembl"
      recovery_hint: "The Ensembl ID does not exist. Verify the ID or use search_genes to find valid gene identifiers."
      invalid_input: "ENSG99999999999"

adr_compliance:
  - ADR-001 section 3: Fuzzy-to-Fact Phase 2 (strict CURIE validation)
  - ADR-001 section 4: Agentic Biolink schema with cross_references
  - ADR-001 section 8: Canonical ErrorEnvelope
  - ADR-001 Appendix A: Cross-reference key registry
  - Constitution II: Fuzzy-to-Fact Protocol (UNRESOLVED_ENTITY on invalid format)
  - Constitution III: Schema Determinism (omit null cross-refs)
  - Constitution IV: Token Budgeting (slim mode support)
