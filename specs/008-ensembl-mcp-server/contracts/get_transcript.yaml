# Tool Contract: get_transcript

tool_name: get_transcript
phase: strict
protocol: Fuzzy-to-Fact Phase 2

description: |
  Strict lookup of transcript record by Ensembl Transcript ID.
  Requires valid ENST ID (typically obtained from get_gene transcripts list).
  Returns full transcript details with cross-references.

inputs:
  transcript_id:
    type: string
    required: true
    pattern: "^ENST\\d{11}$"
    description: Ensembl Transcript ID (format ENST + 11 digits)
    examples:
      - "ENST00000269305"  # TP53-201 (canonical)
      - "ENST00000357654"  # BRCA1-201 (canonical)
      - "ENST00000445888"  # TP53-202

  slim:
    type: boolean
    required: false
    default: false
    description: Return minimal fields without cross_references (~50 vs ~100-200 tokens)

output:
  envelope: null  # Direct entity return (not paginated)
  content_type: EnsemblTranscript
  schema:
    type: object
    properties:
      id:
        type: string
        pattern: "^ENST\\d{11}$"
        example: "ENST00000269305"
      display_name:
        type: string
        example: "TP53-201"
      biotype:
        type: string
        example: "protein_coding"
      parent_gene:
        type: string
        pattern: "^ENSG\\d{11}$"
        example: "ENSG00000141510"
      is_canonical:
        type: boolean
        example: true
      species:
        type: string
        example: "homo_sapiens"
      assembly_name:
        type: string
        example: "GRCh38"
      chromosome:
        type: string
        example: "17"
      start:
        type: integer
        example: 7661779
      end:
        type: integer
        example: 7687538
      strand:
        type: integer
        enum: [1, -1]
        example: -1
      cross_references:
        type: object
        description: External database identifiers (keys omitted if no value)
        properties:
          ensembl_gene:
            type: string
            pattern: "^ENSG\\d{11}$"
            example: "ENSG00000141510"
          uniprot:
            type: array
            items:
              type: string
            example: ["P04637"]
          refseq:
            type: array
            items:
              type: string
            example: ["NM_000546.6", "NP_000537.3"]
          ccds:
            type: string
            example: "CCDS11118"

errors:
  UNRESOLVED_ENTITY:
    http_status: 400
    message: "Invalid Ensembl Transcript ID format"
    recovery_hint: "Use get_gene to retrieve transcript IDs from a gene record. Format: ENST + 11 digits (e.g., ENST00000269305)"
    trigger: Input does not match ^ENST\d{11}$ pattern

  ENTITY_NOT_FOUND:
    http_status: 404
    message: "Transcript not found in Ensembl"
    recovery_hint: "The Ensembl Transcript ID does not exist. Verify the ID or use get_gene to find transcript IDs for a gene."
    trigger: Valid format but Ensembl API returns 404

  RATE_LIMITED:
    http_status: 429
    message: "Exceeded rate limit (15 requests/second)"
    recovery_hint: "Wait for the time specified in Retry-After header before retrying"
    trigger: Ensembl API returns HTTP 429

  UPSTREAM_ERROR:
    http_status: 502/503/504
    message: "Ensembl API error"
    recovery_hint: "Ensembl service may be temporarily unavailable. Retry after a few seconds."
    trigger: Ensembl API returns 5xx error

examples:
  - name: Get TP53 canonical transcript
    input:
      transcript_id: "ENST00000269305"
    output:
      id: "ENST00000269305"
      display_name: "TP53-201"
      biotype: "protein_coding"
      parent_gene: "ENSG00000141510"
      is_canonical: true
      species: "homo_sapiens"
      assembly_name: "GRCh38"
      chromosome: "17"
      start: 7669609
      end: 7687538
      strand: -1
      cross_references:
        ensembl_gene: "ENSG00000141510"
        uniprot: ["P04637"]
        refseq: ["NM_000546.6", "NP_000537.3"]
        ccds: "CCDS11118"

  - name: Get transcript in slim mode
    input:
      transcript_id: "ENST00000357654"
      slim: true
    output:
      id: "ENST00000357654"
      display_name: "BRCA1-201"
      biotype: "protein_coding"
      parent_gene: "ENSG00000012048"
      is_canonical: true
      species: "homo_sapiens"
      assembly_name: "GRCh38"
      chromosome: "17"
      start: 43044295
      end: 43170245
      strand: -1
      # cross_references omitted in slim mode

  - name: Invalid ID format error (gene ID passed)
    input:
      transcript_id: "ENSG00000141510"
    error:
      code: "UNRESOLVED_ENTITY"
      message: "Invalid Ensembl Transcript ID format"
      recovery_hint: "Use get_gene to retrieve transcript IDs from a gene record. Format: ENST + 11 digits (e.g., ENST00000269305)"
      invalid_input: "ENSG00000141510"

  - name: Transcript not found error
    input:
      transcript_id: "ENST99999999999"
    error:
      code: "ENTITY_NOT_FOUND"
      message: "Transcript 'ENST99999999999' not found in Ensembl"
      recovery_hint: "The Ensembl Transcript ID does not exist. Verify the ID or use get_gene to find transcript IDs for a gene."
      invalid_input: "ENST99999999999"

adr_compliance:
  - ADR-001 section 3: Fuzzy-to-Fact Phase 2 (strict CURIE validation)
  - ADR-001 section 4: Agentic Biolink schema with cross_references
  - ADR-001 section 8: Canonical ErrorEnvelope
  - ADR-001 Appendix A: Cross-reference key registry
  - Constitution II: Fuzzy-to-Fact Protocol (UNRESOLVED_ENTITY on invalid format)
  - Constitution III: Schema Determinism (omit null cross-refs)
  - Constitution IV: Token Budgeting (slim mode support)
