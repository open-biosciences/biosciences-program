{
  "tool_name": "search_compounds",
  "description": "Fuzzy search for compounds by name, synonym, or identifier. Returns ranked candidates for resolution. Use this before calling get_compound.",
  "parameters": {
    "type": "object",
    "properties": {
      "query": {
        "type": "string",
        "description": "Search term (compound name, synonym, or natural language query). Minimum 2 characters required.",
        "minLength": 2,
        "examples": ["aspirin", "ibuprofen", "acetylsalicylic acid", "caffeine"]
      },
      "slim": {
        "type": "boolean",
        "description": "If true, return minimal fields (~20 tokens per entity). Default false returns full candidates.",
        "default": false
      },
      "cursor": {
        "type": ["string", "null"],
        "description": "Opaque cursor for pagination. Pass from previous response for next page.",
        "default": null
      },
      "page_size": {
        "type": "integer",
        "description": "Number of results per page (1-100, default 50).",
        "minimum": 1,
        "maximum": 100,
        "default": 50
      }
    },
    "required": ["query"]
  },
  "returns": {
    "oneOf": [
      {
        "type": "object",
        "description": "PaginationEnvelope with PubChemSearchCandidate items",
        "properties": {
          "items": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "string",
                  "pattern": "^PubChem:CID\\d+$",
                  "description": "PubChem CURIE (e.g., 'PubChem:CID2244')"
                },
                "name": {
                  "type": ["string", "null"],
                  "description": "Common compound name (Title)"
                },
                "molecular_formula": {
                  "type": ["string", "null"],
                  "description": "Molecular formula (e.g., 'C9H8O4')"
                },
                "score": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0,
                  "description": "Relevance score (1.0 = best match)"
                }
              },
              "required": ["id", "score"]
            }
          },
          "pagination": {
            "type": "object",
            "properties": {
              "cursor": {"type": ["string", "null"]},
              "total_count": {"type": ["integer", "null"]},
              "page_size": {"type": "integer"}
            },
            "required": ["cursor", "page_size"]
          }
        },
        "required": ["items", "pagination"]
      },
      {
        "$ref": "#/components/schemas/ErrorEnvelope"
      }
    ]
  },
  "errors": [
    {
      "code": "AMBIGUOUS_QUERY",
      "condition": "Query too short (<2 characters)",
      "recovery_hint": "Minimum query length is 2 characters"
    },
    {
      "code": "RATE_LIMITED",
      "condition": "Rate limit exceeded (>5 req/s or >400 req/min)",
      "recovery_hint": "PubChem rate limit exceeded. Wait 60s before retrying."
    },
    {
      "code": "UPSTREAM_ERROR",
      "condition": "PubChem API unavailable or returned error",
      "recovery_hint": "PubChem API temporarily unavailable. Retry in 60 seconds."
    }
  ],
  "examples": [
    {
      "name": "Search for aspirin",
      "request": {
        "query": "aspirin",
        "slim": false,
        "page_size": 10
      },
      "response": {
        "items": [
          {
            "id": "PubChem:CID2244",
            "name": "Aspirin",
            "molecular_formula": "C9H8O4",
            "score": 1.0
          },
          {
            "id": "PubChem:CID135565885",
            "name": "Aspirin-d4",
            "molecular_formula": "C9H4D4O4",
            "score": 0.95
          }
        ],
        "pagination": {
          "cursor": "eyJvZmZzZXQiOjEwfQ==",
          "total_count": 42,
          "page_size": 10
        }
      }
    },
    {
      "name": "Empty search results",
      "request": {
        "query": "xyznonexistentcompound123"
      },
      "response": {
        "items": [],
        "pagination": {
          "cursor": null,
          "total_count": 0,
          "page_size": 50
        }
      }
    },
    {
      "name": "Query too short error",
      "request": {
        "query": "a"
      },
      "response": {
        "success": false,
        "error": {
          "code": "AMBIGUOUS_QUERY",
          "message": "Query too short: 'a'",
          "recovery_hint": "Minimum query length is 2 characters",
          "invalid_input": "a"
        }
      }
    }
  ],
  "rate_limits": {
    "per_second": 5,
    "per_minute": 400,
    "backoff_strategy": "exponential",
    "base_delay_seconds": 1,
    "max_delay_seconds": 60
  },
  "constitution_compliance": {
    "principle_i": "Async httpx client with connection pooling",
    "principle_ii": "Fuzzy search - accepts natural language queries",
    "principle_iii": "Returns Canonical PaginationEnvelope",
    "principle_iv": "Supports slim mode for token budgeting",
    "rate_limiting": "Dual rate limiting (5 req/s + 400 req/min) with exponential backoff"
  }
}
