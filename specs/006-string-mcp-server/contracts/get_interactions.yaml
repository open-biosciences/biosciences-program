# Tool Contract: get_interactions

tool_name: get_interactions
phase: strict
protocol: Fuzzy-to-Fact Phase 2

description: |
  Get protein-protein interaction network for a STRING protein identifier.
  Requires resolved STRING CURIE from search_proteins().
  Returns interactions with 7 evidence channel scores.

inputs:
  string_id:
    type: string
    required: true
    pattern: "^STRING:\\d+\\.(ENSP\\d+|[a-z]\\d+)$"
    description: STRING CURIE from search_proteins()
    examples:
      - "STRING:9606.ENSP00000269305"  # TP53
      - "STRING:10090.ENSMUSP00000005371"  # Mouse Tp53

  required_score:
    type: integer
    required: false
    default: 400
    min: 0
    max: 1000
    description: |
      Minimum combined confidence score (0-1000).
      400 = medium confidence
      700 = high confidence
      900 = highest confidence

  limit:
    type: integer
    required: false
    default: 10
    description: Maximum number of interactions to return

output:
  type: InteractionNetwork
  schema:
    type: object
    properties:
      id:
        type: string
        pattern: "^STRING:\\d+\\.(ENSP\\d+|[a-z]\\d+)$"
        example: "STRING:9606.ENSP00000269305"
      preferred_name:
        type: string
        example: "TP53"
      annotation:
        type: string
        nullable: true
        example: "Cellular tumor antigen p53"
      taxon_id:
        type: integer
        example: 9606
      interaction_count:
        type: integer
        example: 3
      interactions:
        type: array
        items:
          type: object
          properties:
            string_id_a:
              type: string
              example: "9606.ENSP00000269305"
            string_id_b:
              type: string
              example: "9606.ENSP00000258149"
            preferred_name_a:
              type: string
              example: "TP53"
            preferred_name_b:
              type: string
              example: "MDM2"
            taxon_id:
              type: integer
              example: 9606
            score:
              type: number
              minimum: 0.0
              maximum: 1.0
              example: 0.999
            evidence:
              type: object
              properties:
                nscore: { type: number, minimum: 0.0, maximum: 1.0 }
                fscore: { type: number, minimum: 0.0, maximum: 1.0 }
                pscore: { type: number, minimum: 0.0, maximum: 1.0 }
                ascore: { type: number, minimum: 0.0, maximum: 1.0 }
                escore: { type: number, minimum: 0.0, maximum: 1.0 }
                dscore: { type: number, minimum: 0.0, maximum: 1.0 }
                tscore: { type: number, minimum: 0.0, maximum: 1.0 }
      network_image_url:
        type: string
        format: uri
        example: "https://string-db.org/api/highres_image/network?identifiers=9606.ENSP00000269305&species=9606&add_nodes=10"
      cross_references:
        type: object
        nullable: true
        properties:
          ensembl_gene:
            type: string
            nullable: true
          uniprot:
            type: string
            nullable: true
          hgnc:
            type: string
            nullable: true

errors:
  UNRESOLVED_ENTITY:
    http_status: 400
    message: "Invalid STRING CURIE format"
    recovery_hint: "Call search_proteins to resolve the identifier first. Expected format: STRING:<taxid>.ENSP<id>"
    trigger: Input doesn't match STRING CURIE pattern

  ENTITY_NOT_FOUND:
    http_status: 404
    message: "No interactions found for STRING ID"
    recovery_hint: "Verify the STRING ID format or try lowering the required_score threshold"
    trigger: STRING API returns empty results

  RATE_LIMITED:
    http_status: 429
    message: "Exceeded rate limit (1 request/second)"
    recovery_hint: "Wait 1 second before retrying"
    trigger: More than 1 request per second

  UPSTREAM_ERROR:
    http_status: 502/503/504
    message: "STRING API error"
    recovery_hint: "Retry after a short delay"
    trigger: STRING API returns 5xx error

examples:
  - name: Get TP53 interactions with high confidence
    input:
      string_id: "STRING:9606.ENSP00000269305"
      required_score: 700
      limit: 3
    output:
      id: "STRING:9606.ENSP00000269305"
      preferred_name: "TP53"
      annotation: "Cellular tumor antigen p53"
      taxon_id: 9606
      interaction_count: 3
      interactions:
        - string_id_a: "9606.ENSP00000269305"
          string_id_b: "9606.ENSP00000258149"
          preferred_name_a: "TP53"
          preferred_name_b: "MDM2"
          taxon_id: 9606
          score: 0.999
          evidence:
            nscore: 0.0
            fscore: 0.0
            pscore: 0.12
            ascore: 0.45
            escore: 0.92
            dscore: 0.90
            tscore: 0.99
      network_image_url: "https://string-db.org/api/highres_image/network?identifiers=9606.ENSP00000269305&species=9606&add_nodes=10"

  - name: Invalid CURIE format error
    input:
      string_id: "9606.ENSP00000269305"  # Missing "STRING:" prefix
    error:
      code: "UNRESOLVED_ENTITY"
      message: "The input '9606.ENSP00000269305' is not a valid STRING CURIE."
      recovery_hint: "Call search_proteins to resolve the identifier first. Expected format: STRING:<taxid>.ENSP<id>"
      invalid_input: "9606.ENSP00000269305"

adr_compliance:
  - ADR-001 ยง3: Fuzzy-to-Fact Phase 2 (accepts only resolved CURIEs)
  - ADR-001 ยง4: Agentic Biolink schema with cross_references
  - ADR-001 ยง8: Canonical ErrorEnvelope
  - Constitution III: Schema Determinism
  - Constitution v1.1: Rate limiting (1 req/s)
