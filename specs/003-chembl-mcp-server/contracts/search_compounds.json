{
  "tool_name": "search_compounds",
  "description": "Fuzzy search for compounds by name, synonym, or identifier. Returns ranked candidates for resolution. Use this before calling get_compound.",
  "parameters": {
    "type": "object",
    "properties": {
      "query": {
        "type": "string",
        "description": "Search term (compound name, synonym, or natural language query). Minimum 2 characters required.",
        "minLength": 2,
        "examples": ["aspirin", "imatinib", "kinase inhibitor"]
      },
      "slim": {
        "type": "boolean",
        "description": "If true, return minimal fields (~20 tokens per entity). Default false returns full candidates.",
        "default": false
      },
      "cursor": {
        "type": ["string", "null"],
        "description": "Opaque cursor for pagination. Pass from previous response for next page.",
        "default": null
      },
      "page_size": {
        "type": "integer",
        "description": "Number of results per page (1-100, default 50).",
        "minimum": 1,
        "maximum": 100,
        "default": 50
      }
    },
    "required": ["query"]
  },
  "returns": {
    "oneOf": [
      {
        "type": "object",
        "description": "PaginationEnvelope with CompoundSearchCandidate items",
        "properties": {
          "items": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "string",
                  "pattern": "^CHEMBL:[0-9]+$",
                  "description": "ChEMBL CURIE"
                },
                "name": {
                  "type": ["string", "null"],
                  "description": "Preferred compound name"
                },
                "molecular_formula": {
                  "type": ["string", "null"],
                  "description": "Molecular formula"
                },
                "score": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0,
                  "description": "Relevance score"
                }
              },
              "required": ["id", "score"]
            }
          },
          "pagination": {
            "type": "object",
            "properties": {
              "cursor": {"type": ["string", "null"]},
              "total_count": {"type": ["integer", "null"]},
              "page_size": {"type": "integer"}
            },
            "required": ["cursor", "page_size"]
          }
        },
        "required": ["items", "pagination"]
      },
      {
        "$ref": "#/components/schemas/ErrorEnvelope"
      }
    ]
  },
  "errors": [
    {
      "code": "AMBIGUOUS_QUERY",
      "condition": "Query too short (<2 characters)",
      "recovery_hint": "Minimum query length is 2 characters"
    },
    {
      "code": "RATE_LIMITED",
      "condition": "Rate limit exceeded (>10 req/s)",
      "recovery_hint": "Wait {backoff_seconds}s before retrying"
    },
    {
      "code": "UPSTREAM_ERROR",
      "condition": "ChEMBL API unavailable",
      "recovery_hint": "ChEMBL API temporarily unavailable - retry in 60 seconds"
    }
  ],
  "examples": [
    {
      "request": {
        "query": "aspirin",
        "slim": false,
        "page_size": 10
      },
      "response": {
        "items": [
          {
            "id": "CHEMBL:25",
            "name": "Aspirin",
            "molecular_formula": "C9H8O4",
            "score": 1.0
          },
          {
            "id": "CHEMBL:1201583",
            "name": "Acetylsalicylic acid lysinate",
            "molecular_formula": "C15H19N2O7",
            "score": 0.85
          }
        ],
        "pagination": {
          "cursor": "eyJvZmZzZXQiOjEwfQ==",
          "total_count": 42,
          "page_size": 10
        }
      }
    }
  ],
  "constitution_compliance": {
    "principle_ii": "Fuzzy search - accepts natural language",
    "principle_iii": "Returns PaginationEnvelope",
    "principle_iv": "Supports slim mode for token budgeting"
  }
}
