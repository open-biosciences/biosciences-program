# ADR-003: SpecKit Skills for Specification-Driven Development

**Status:** Draft
**Date:** 2025-12-21
**Extends:** ADR-002 (Project Skills as Platform Engineering)
**Context:** ADR-002 established skills as the mechanism for distributing architectural standards (the **tools**). This ADR extends that pattern to the *specification and planning phases* of development (the **process**), ensuring that feature requests flow through a disciplined workflow before code is written.

**Reference:**
- *Team Topologies* (Pais & Skelton) - Cognitive load management
- AI-Augmented Team Topologies (graphiti_meta_knowledge) - Bounded agent design with explicit gates

---

## 1. Context and Problem Statement

When agents receive feature requests directly, they often:

- **Skip specification** - Jump straight to code, missing edge cases
- **Ignore existing patterns** - Create inconsistent implementations
- **Accumulate verification debt** - Ship faster than humans can review
- **Exhaust review capacity** - AI PRs overwhelm team cognitive load

The knowledge graph captures a validated insight: *"Documentation-driven development forces explicit rules. Edge cases are codified into rubrics, not discovered in production."*

We need a mechanism to enforce a **specification gate** before implementation begins.

---

## 2. Decision: SpecKit as Specification Platform

We will adopt the **SpecKit skill family** as the specification layer of our Platform-as-Product, ensuring that every feature flows through a structured workflow before code generation.

### 2.1 The SpecKit Workflow

```
┌─────────────────────────────────────────────────────────────────┐
│                    SPECIFICATION PHASE                          │
│                                                                 │
│  ┌──────────────┐                                               │
│  │/constitution │───▶ Establishes project constraints (ADRs)   │
│  └──────────────┘                                               │
│         │                                                       │
│         ▼                                                       │
│  ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐  │
│  │/specify  │───▶│/clarify  │───▶│  /plan   │───▶│  /tasks  │  │
│  └──────────┘    └──────────┘    └──────────┘    └──────────┘  │
│       │               │               │               │         │
│       ▼               ▼               ▼               ▼         │
│   spec.md      clarifications    plan.md        tasks.md       │
│                                                                 │
│  ┌──────────┐                                                   │
│  │ /analyze │◀─── Validates against Constitution + artifacts   │
│  └──────────┘                                                   │
└─────────────────────────────────────────────────────────────────┘
                              │
                    VERIFICATION GATE
                    (Human approval required)
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                   IMPLEMENTATION PHASE                          │
│  ┌──────────┐                                                   │
│  │/implement│───▶ Delegates to Platform Skills (ADR-002)       │
│  └──────────┘     then executes bounded tasks                  │
└─────────────────────────────────────────────────────────────────┘
```

### 2.2 Skill Responsibilities

| Skill | Trigger | Output | Gate |
|-------|---------|--------|------|
| `/speckit.constitution` | "Establish project principles" | Constitution defining constraints | **Required for new projects** |
| `/speckit.specify` | "Create spec for X", "Design feature Y" | `spec.md` | None |
| `/speckit.clarify` | Implicit after /specify | 5 targeted questions | User answers required |
| `/speckit.plan` | "Plan implementation" | `plan.md` with architecture | None |
| `/speckit.tasks` | "Generate tasks" | `tasks.md` dependency-ordered | None |
| `/speckit.analyze` | Before implementation | Consistency + Constitution compliance | **Blocks on violations** |
| `/speckit.implement` | "Implement the plan" | Code changes via Platform Skills | **Human approval** |

---

## 3. Implementation Standard: The 5-Stage Verification Model

Based on the AI-Augmented Development Workflow captured in the knowledge graph:

### Stage 1: AI Generation (Specification)

- Agent invokes `/specify` to transform natural language to structured spec
- Fast, low-risk: generates documentation, not code

### Stage 2: Platform Guardrails (Clarification)

- `/clarify` surfaces underspecified areas automatically
- Prevents "garbage in, garbage out" specification debt

### Stage 3: Verification Pivot (Plan Review)

- **Critical gate**: Agent pauses after `/plan` and `/tasks`
- Human reviews architecture decisions before code generation
- Prevents runaway implementation of flawed designs

### Stage 4: Verification Hygiene (Analyze)

- `/analyze` performs cross-artifact consistency check
- **Critical Check:** Validates that the Architecture Plan adheres to the constraints defined in `/speckit.constitution`:
  - ADR compliance (e.g., "All servers must use FastMCP scaffolding" from ADR-001)
  - Forbidden patterns (e.g., "No synchronous blocking calls")
  - Required patterns (e.g., "All deployments require pre-flight checks")
- Catches spec-plan-task drift before implementation
- **Blocks implementation if Constitution violations detected**

### Stage 5: Safe Implementation

- `/implement` executes with explicit task boundaries
- **Delegates to Platform Skills first** (see Section 5.1)
- Each task is a bounded unit of work with verification checkpoint

---

## 4. Cognitive Load Management

### 4.1 Bounded Agent Design

From Team Topologies principles, we enforce:

```yaml
# Skill constraint pattern
constraints:
  max_tasks_per_session: 5      # Prevent PR sprawl
  require_human_gate: true       # After plan phase
  explicit_scope_boundary: true  # No scope creep
```

### 4.2 Single Writer Ownership

Each specification artifact has one owner:

| Artifact | Owner | Write Permission |
|----------|-------|------------------|
| constitution.md | /constitution | Create once, amend via ADR |
| spec.md | /specify | Create, update via /clarify |
| plan.md | /plan | Create only |
| tasks.md | /tasks | Create only |
| Code | /implement | Bounded by tasks.md |

This prevents coordination failures when multiple skills or agents operate on the same feature.

---

## 5. Skill Structure Extension

Extending ADR-002's skill structure for SpecKit. **All skills must include versioning per ADR-002's "Versioning as Code" mandate:**

```text
.claude/skills/
└── speckit/
    ├── SKILL.md              # Orchestrator: routes to sub-skills (version: x.y.z)
    ├── constitution/
    │   ├── SKILL.md          # Project constraints definition
    │   └── templates/
    │       └── constitution-template.md
    ├── specify/
    │   ├── SKILL.md          # Specification generation logic
    │   └── templates/
    │       └── spec-template.md
    ├── clarify/
    │   └── SKILL.md          # Question generation logic
    ├── plan/
    │   ├── SKILL.md          # Architecture planning logic
    │   └── templates/
    │       └── plan-template.md
    ├── tasks/
    │   ├── SKILL.md          # Task decomposition logic
    │   └── templates/
    │       └── tasks-template.md
    ├── analyze/
    │   └── SKILL.md          # Constitution + consistency checker
    └── implement/
        └── SKILL.md          # Bounded execution with Platform delegation
```

### 5.1 The `/implement` Skill: Platform Skill Chaining

The `/speckit.implement` skill **must delegate to Platform Skills (ADR-002) before writing code directly**:

```markdown
# implement/SKILL.md
---
name: speckit-implement
version: 1.0.0
description: Execute tasks with Platform Skill delegation
---

## Execution Rules

Before writing new files, check if a **Platform Skill** (ADR-002) exists for the task:

1. **IF creating a new MCP server:** Invoke `scaffold-fastmcp`
2. **IF deploying to cloud:** Invoke `deploy-fastmcp-cloud`
3. **IF creating a new API endpoint:** Invoke `scaffold-api-endpoint`
4. **ONLY write code manually** if no Platform Skill matches the task type

## Rationale

Platform Skills encode organizational standards. Direct code generation bypasses
these standards and creates drift. Always prefer delegation over manual creation.
```

This ensures that implementation respects the "Golden Paths" defined in ADR-002.

---

## 6. Consequences

### Positive

- **Reduced Rework:** Specifications surface edge cases before code exists
- **Reviewable Artifacts:** Humans review plans, not 500-line PRs
- **Bounded Implementation:** Tasks are scoped; no "while I'm here" drift
- **Team Alignment:** Spec artifacts enable async collaboration
- **Audit Trail:** Decision rationale captured in plan.md
- **Constitution Enforcement:** ADR violations caught before code is written

### Negative

- **Perceived Slowdown:** Developers may resist "extra steps" before coding
- **Skill Maintenance:** Template updates required as patterns evolve
- **Over-specification Risk:** Simple features may not need full workflow
- **Constitution Overhead:** Requires upfront investment in defining constraints

### Mitigations

| Risk | Mitigation |
|------|------------|
| Slowdown perception | Measure: time-to-production, not time-to-first-commit |
| Template drift | Quarterly review of templates against shipped features (per ADR-002 versioning) |
| Over-specification | Skills detect complexity; skip steps for trivial changes |
| Constitution overhead | Start minimal; grow Constitution from actual ADRs and incidents |

---

## 7. Integration with ADR-002

This ADR extends ADR-002's scaffolding and deployment patterns. Together they solve the "Agentic Chaos" problem:

- **ADR-002** builds the **tools** (Platform Skills)
- **ADR-003** builds the **process** (Specification-Driven SDLC)

```
ADR-002 Skills (What)          ADR-003 Skills (How)
─────────────────────          ─────────────────────
Scaffolder (FastMCPv2)    ◀─── /specify defines what to scaffold
                          ◀─── /implement delegates to scaffolder
Deployment Guardrail      ◀─── /implement delegates to deployer
Versioning (SKILL.md)     ◀─── All SpecKit skills follow version mandate
```

The SpecKit workflow feeds into ADR-002's execution skills, ensuring that scaffolding and deployment receive well-specified inputs. The `/implement` skill explicitly chains to Platform Skills rather than bypassing them.

---

## 8. Compliance

This decision aligns with:

- **Team Topologies:** Specification skills reduce cognitive load by providing "Golden Path" workflows
- **AI-Augmented Team Topology:** Explicit gates prevent AI velocity from exceeding human verification capacity
- **Documentation-Driven Development:** Examples and specs force explicit rules before code
- **Platform-as-Product:** Constitution acts as the "API contract" for architectural compliance

---

## 9. Decision

We will implement the SpecKit skill family as described, with:

1. **Immediate:** Deploy /specify and /plan skills
2. **Phase 2:** Add /clarify with automated question generation
3. **Phase 3:** Implement /analyze with Constitution validation
4. **Phase 4:** Full /implement with Platform Skill chaining

---

## 10. References

### Knowledge Graph Sources

The following entities from `graphiti_meta_knowledge` informed this ADR:

- **AI-Augmented Team Topology** - Framework for human-machine collaboration with cognitive load emphasis
- **Team Topologies principles** - Bounded agent design with explicit gates
- **5-Stage AI-Augmented Development Workflow** - Verification Pivot pattern
- **Documentation-driven development** - Forces explicit rules via examples
- **Single Writer with Namespace Ownership** - Prevents coordination failures

### External References

- Pais, M. & Skelton, M. (2019). *Team Topologies: Organizing Business and Technology Teams for Fast Flow*
- ADR-002: Project Skills as Platform Engineering (internal)

---

## Appendix A: Constitution Example

```markdown
# Project Constitution

## Architectural Constraints (from ADRs)

### ADR-001: FastMCP as Standard Framework
- All MCP servers MUST use FastMCP scaffolding
- No bare Python scripts without project structure

### ADR-002: Platform Skills
- New components MUST be created via Platform Skills when available
- Skills MUST include version field in frontmatter

## Forbidden Patterns
- No synchronous blocking calls in async contexts
- No hardcoded credentials (use environment variables)
- No direct database access outside repository pattern

## Required Patterns
- All deployments require pre-flight checks (ruff, pytest)
- All new APIs require OpenAPI specification
- All state mutations require audit logging
```

---

**Approved by:** [Platform Engineering Lead]
**Implementation tracking:** [Linear issue TBD]
